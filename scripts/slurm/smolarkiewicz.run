#!/bin/bash -l
#SBATCH --account=s299m
#SBATCH --time=24:00:00
#SBATCH --nodes=1
#SBATCH --partition=normal
#SBATCH --constraint=mc
#SBATCH --output=output/slurm-%j.out
#SBATCH --error=error/slurm-%j.err

module load daint-mc
module load shifter-ng

srun --unbuffered shifter run \
	--writable-volatile=/home/tasmania-user/py35 \
	--writable-volatile=/home/tasmania-user/py36 \
	--writable-volatile=/home/tasmania-user/py37 \
	--writable-volatile=/home/tasmania-user/tasmania \
	load/library/tasmania:master \
	bash -c "cp -r tasmania/tasmania/python ~/tasmania/tasmania; \
		 cp -r tasmania/tasmania/__init__.py ~/tasmania/tasmania; \
		 cd ~; \
		 . py36/bin/activate; \
		 cd $SCRATCH/tasmania/drivers/smolarkiewicz; \
		 cp namelists/namelist_smolarkiewicz_ssus_1.py namelist_smolarkiewicz_ssus.py; \
		 python driver_namelist_smolarkiewicz_ssus.py; \
		 cp namelists/namelist_smolarkiewicz_ssus_2.py namelist_smolarkiewicz_ssus.py; \
		 python driver_namelist_smolarkiewicz_ssus.py; \
		 cp namelists/namelist_smolarkiewicz_ssus_3.py namelist_smolarkiewicz_ssus.py; \
		 python driver_namelist_smolarkiewicz_ssus.py; \
		 deactivate; \
		 exit"
